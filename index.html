<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>My Personal Assistant</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="dist/css/main.css">
</head>
<body>
    <div class="container">
        <div class="input">
            <div class="input__icon">
                <span class="fa fa-terminal"></span>
            </div>
            <input id="input" autofocus="true" type="text" placeholder="Type your commands here...">
            <div class="notifications" id="notifications"></div>
        </div>
        <div class="tools">
            <button id="clear"><span class="fa fa-trash-o"></span> Clear</button>
            <div class="group right">
                <button id="undo"><span class="fa fa-undo"></span> Undo</button>
                <button id="redo"><span class="fa fa-repeat"></span> Redo</button>
            </div>
        </div>
        <div class="output" id="output"></div>
    </div>

    <script>
    const UP = 38;
    const DOWN = 40;
    const ENTER = 13;
    const input = document.getElementById('input');
    const output = document.getElementById('output');
    const undo = document.getElementById('undo');
    const redo = document.getElementById('redo');
    const clear = document.getElementById('clear');
    const notifications = document.getElementById('notifications');

    window.Event = Event = require("./dist/js/modules/Event");
    window.cards = require('./dist/js/modules/cardManager')(output, undo, redo);

    clear.addEventListener('click', function() {
        Event.fire('clear');
    });

    var historyManager = require('./dist/js/modules/HistoryManager');
    var pluginManager = require('./dist/js/modules/PluginManager');
    var notificationManager = require('./dist/js/modules/NotificationManager')(notifications);

    document.addEventListener('keydown', event => {
        var EMPTY = "";

        switch (event.keyCode) {
            case UP:
                var previous = historyManager.backward();
                input.value = previous ? previous.command : EMPTY;
                break;
            case DOWN:
                var next = historyManager.forward();
                input.value = next ? next.command : EMPTY;
                break;
        }
    });

    input.addEventListener('keyup', event => {
        if (event.keyCode == ENTER) {
            var value = event.target.value;
            processInput(value);
            input.value = "";
        }
    });

    var processInput = input => {
        pluginManager.execute(input);
        historyManager.push(input);
    };

    /** Default Plugins */
    // pluginManager.loadFrom('dist/js/modules/plugins');
    pluginManager.register("Clear", require('./dist/js/modules/plugins/Clear'));
    pluginManager.register("History", require('./dist/js/modules/plugins/History'));
    pluginManager.register("Help", require('./dist/js/modules/plugins/Help'));
    pluginManager.register("File", require('./dist/js/modules/plugins/File'));

    /** Print Help Card */
    pluginManager.execute("help");
    </script>
</body>
</html>
